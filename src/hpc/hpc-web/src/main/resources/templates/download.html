
<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<link rel="stylesheet" type="text/css" href="../css/style.css" />
<link href="../css/bootstrap.min.css" rel="stylesheet" />
<link href="../css/bootstrap-theme.css" rel="stylesheet" />

<script src="../js/angular/1.4.3/angular.js"></script>
<script src="../js/angular/1.4.3/angular-touch.js"></script>
<script src="../js/angular/1.4.3/angular-animate.js"></script>
<script src="../js/ui-grid/csv.js"></script>
<script src="../js/ui-grid/pdfmake.js"></script>
<script src="../js/ui-grid/vfs_fonts.js"></script>
<script src="../js/ui-grid/ui-grid.js"></script>
<link rel="stylesheet" href="http://ui-grid.info/release/ui-grid.css"
	type="text/css" />
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal">&times;</button>
		<h4 class="modal-title">Download</h4>
	</div>
	<div class="modal-body">
		<form class="form-horizontal" id="downloadForm"
			th:object="${hpcDownloadDatafile}">
			<div class="pull-left" id="message"
				style="display: none; float: left">
				<p>&nbsp;</p>
			</div>
			<p>You may download data file to your local computer
				(synchronous) or to a Global endpoint location (asynchronous). If
				you are using asynchronous option, you will need to first give WRITE
				access on your Globus download location to HPC DME Service account
				&quot;ncif-hpcdm-svc&quot;</p>
			<div class="panel panel-default">
				<div class="panel-body">
					<table>
						<tr>
							<td>
								<div class="form-group">
									<label class="radio-inline"><input type="radio"
										name="searchType" id="searchType" value="async"
										onChange="display(this)" />Asynchronous</label> <label
										class="radio-inline"><input type="radio"
										id="searchType" name="searchType" value="sync"
										onChange="display(this)" />Synchronous</label>
								</div>
								<div class="form-group" id="AsyncDiv" style="display: none">
									<div class="col-sm-12 column">
										<label for="endPointName">Globus Endpoint Name:</label> <input
											type="text" class="form-control" th:field="*{endPointName}"
											id="endPointName" placeholder="Enter Globus Endpoint name" />
									</div>
									<div class="col-sm-12 column">
										<label for="endPointLocation">Globus Endpoint Path:</label> <input
											type="text" class="form-control"
											th:field="*{endPointLocation}" id="endPointLocation"
											placeholder="Enter Globus Endpoint Path" size="40"/>
									</div>
								</div>
								<div class="form-group" id="SyncDiv" style="display: none">
									<div class="col-sm-12 column">
										<label for="downloadFileName">Download file name:</label> <input
											type="text" class="form-control"
											th:field="*{downloadFileName}" id="downloadFileName"
											placeholder="Enter Download file name" />
									</div>
								</div>
								<div class="modal-footer">
									<button class="btn btn-success" id="submit" onClick="return validateAndSubmit()">Download</button>
									<button type="button" class="btn btn-default"
										data-dismiss="modal" id="close">Close</button>
								</div>
							</td>
						</tr>
					</table>
					<input type="hidden" name="destinationPath" id="destinationPath"
						th:value="${downloadFilePath}" />
				</div>
			</div>
		</form>
	</div>

	<script>
	
	function validateAndSubmit()
	{
		var radioSelected = document.getElementsByName("searchType");
		var selected1 = radioSelected[0].checked;
		var selected2 = radioSelected[1].checked;

		if(document.getElementById("searchType").value == "async")
		{
			var endPointName = document.getElementById("endPointName").value;
			var endPointLocation = document.getElementById("endPointLocation").value;
			if(endPointLocation == null || endPointLocation.trim().length == 0 || endPointName == null || endPointName.trim().length == 0)
			{
				alert("Please enter asynchronous download values");
				return false;
			}
		}
		else
		{
			var downloadFileName = document.getElementById("downloadFileName").value;
			if(downloadFileName == null || downloadFileName.trim().length == 0)
			{
				alert("Please enter synchronous download file name");
				return false;
			}
		}
		document.getElementById("downloadForm").submit();
	}	
		$(function() {
			//twitter bootstrap script
			var $form = $('#downloadForm');
			$('#downloadForm').on('submit', function(e) {
				e.preventDefault();
				var ele = document.getElementById("message");
				$.ajax({
					type : "POST",
					url : "/download",
					data : $form.serialize(),
					success : function(msg) {
						console.log('SUCCESS: ', msg);
						$('#message').html(msg.message);
						ele.style.display = "block";
					},
					error : function(e) {
						console.log('ERROR: ', e);
						$('#message').html(e.message);
						ele.style.display = "block";
					}
				});

			});
		});

		$(function() {
			//twitter bootstrap script
			$('#downloadForm').on('close', function(e) {
				$('#myModal-event').modal('hide');
			});
		});

		var toggle = true;
		function display(ele) {
			var asyncDiv = document.getElementById("AsyncDiv");
			var syncDiv = document.getElementById("SyncDiv");
			if (ele.value == "async") {
				asyncDiv.style.display = "block";
				syncDiv.style.display = "none";
			} else {
				syncDiv.style.display = "block";
				asyncDiv.style.display = "none";
			}
		}
	</script>

</body>
</html>