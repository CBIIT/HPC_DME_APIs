create view R_BROWSE_META_MAIN as
SELECT data.data_id                                                                     AS id,
       (cast(coll.coll_name as varchar2(2700)) || cast('/' as varchar2(1))) || cast(data.data_name as varchar2(2700))                     AS path,
       cast(meta_size.meta_attr_value as number(19))                                                AS data_size,
       to_timestamp(meta_uploaded.meta_attr_value,'MM-DD-YYYY HH24:MI:SS') AS uploaded
FROM r_data_main data
         JOIN r_coll_main coll ON data.coll_id = coll.coll_id
         LEFT JOIN (r_objt_metamap map_size
    JOIN r_meta_main meta_size ON meta_size.meta_id = map_size.meta_id AND
                                  meta_size.meta_attr_name = 'source_file_size')
                   ON map_size.object_id = data.data_id
         LEFT JOIN (r_objt_metamap map_uploaded
    JOIN r_meta_main meta_uploaded ON meta_uploaded.meta_id = map_uploaded.meta_id AND
                                      meta_uploaded.meta_attr_name = 'data_transfer_completed')
                   ON map_uploaded.object_id = data.data_id
UNION
SELECT r_coll_main.coll_id                                            AS id,
       r_coll_main.coll_name                                          AS path,
       cast(NULL as number(19))                                                   AS data_size,
       to_timestamp('1970-01-01','YYYY-MM-DD') + numtodsinterval(modify_ts,'SECOND') AS uploaded
FROM r_coll_main;

