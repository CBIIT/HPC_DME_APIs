--
-- hpc_data_management_configuration.sql
--
-- Copyright SVG, Inc.
-- Copyright Leidos Biomedical Research, Inc
-- 
-- Distributed under the OSI-approved BSD 3-Clause License.
-- See http://ncip.github.com/HPC/LICENSE.txt for details.
--
--
-- @author <a href="mailto:eran.rosenberg@nih.gov">Eran Rosenberg</a>
--

ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "S3_URL" DROP NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "S3_VAULT" DROP NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "S3_OBJECT_ID" DROP NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "S3_ARCHIVE_TYPE" DROP NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "S3_UPLOAD_REQUEST_URL_EXPIRATION" DROP NOT NULL;

ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_URL" text;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_ARCHIVE_ENDPOINT" text;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_ARCHIVE_PATH" text;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_ARCHIVE_DIRECTORY" text;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_ARCHIVE_TYPE" text;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_DOWNLOAD_ENDPOINT" text;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_DOWNLOAD_PATH" text;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ADD COLUMN "GLOBUS_DOWNLOAD_DIRECTORY" text;

UPDATE public."HPC_DATA_MANAGEMENT_CONFIGURATION" 
       SET "GLOBUS_URL"= 'https://auth.globus.org/v2/oauth2/token', 
           "GLOBUS_ARCHIVE_ENDPOINT" = 'c6790626-aab4-11e7-aef3-22000a92523b',
           "GLOBUS_ARCHIVE_PATH" = '/ServiceFolderFor2Hop',
           "GLOBUS_ARCHIVE_DIRECTORY" = '/mnt/IRODsTest/FNL_SF_Share/ServiceFolderFor2Hop',
           "GLOBUS_ARCHIVE_TYPE" = 'TEMPORARY_ARCHIVE',
           "GLOBUS_DOWNLOAD_ENDPOINT" = 'c6790626-aab4-11e7-aef3-22000a92523b',
           "GLOBUS_DOWNLOAD_PATH" = '/FNL_SF_S3_Download',
           "GLOBUS_DOWNLOAD_DIRECTORY" = '/mnt/IRODsTest/FNL_SF_Share/FNL_SF_S3_Download';                                             ;

ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "GLOBUS_URL" SET NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "GLOBUS_ARCHIVE_ENDPOINT" SET NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "GLOBUS_ARCHIVE_PATH" SET NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "GLOBUS_ARCHIVE_DIRECTORY" SET NOT NULL;
ALTER TABLE public."HPC_DATA_MANAGEMENT_CONFIGURATION" ALTER COLUMN "GLOBUS_ARCHIVE_TYPE" SET NOT NULL;

COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_URL" IS 
                  'The Globus authentication URL';    
COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_ARCHIVE_ENDPOINT" IS 
                  'The Globus archive endpoint ID';    
COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_ARCHIVE_PATH" IS 
                  'The Globus archive endpoint path';    
COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_ARCHIVE_DIRECTORY" IS 
                  'The Globus archive directory (direct file system access to the endpoint)';    
COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_ARCHIVE_TYPE" IS 
                  'The Globus archiove type (ARCHIVE or TEMPORARY_ARCHIVE)';    
COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_DOWNLOAD_ENDPOINT" IS 
                  'The Globus download endpoint ID';    
COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_DOWNLOAD_PATH" IS 
                  'The Globus download endpoint path';    
COMMENT ON COLUMN public."HPC_DATA_MANAGEMENT_CONFIGURATION"."GLOBUS_DOWNLOAD_DIRECTORY" IS 
                  'The Globus download directory (direct file system access to the endpoint)';  
