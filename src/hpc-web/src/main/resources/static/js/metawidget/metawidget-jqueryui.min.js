// Metawidget 4.1 minified
//
// This file is dual licensed under both the LGPL
// (http://www.gnu.org/licenses/lgpl-2.1.html) and the EPL
// (http://www.eclipse.org/org/documents/epl-v10.php). As a
// recipient of Metawidget, you may choose to receive it under either
// the LGPL or the EPL.
//
// Commercial licenses are also available. See http://metawidget.org
// for details.
//
// Author: Richard Kennard (http://kennardconsulting.com)

var metawidget=metawidget||{};(function(){metawidget.jqueryui=metawidget.jqueryui||{};metawidget.jqueryui.widgetbuilder=metawidget.jqueryui.widgetbuilder||{};metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder=function(){if(!(this instanceof metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder)){throw new Error("Constructor called as a function")}};metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder.prototype.buildWidget=function(a,b,f){if(metawidget.util.isTrueOrTrueString(b.readOnly)){return}if(metawidget.util.isTrueOrTrueString(b.hidden)){return}if(b.type==="number"||b.type==="integer"){if(b.minimum&&b.maximum){var d=metawidget.util.createElement(f,"div");$(d).slider();return d}var e=metawidget.util.createElement(f,"input");$(e).spinner();return $(e).spinner("widget")[0]}if(b.type==="date"){var c=metawidget.util.createElement(f,"input");$(c).datepicker();return c}};metawidget.jqueryui.widgetprocessor=metawidget.jqueryui.widgetprocessor||{};metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor=function(){if(!(this instanceof metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor)){throw new Error("Constructor called as a function")}};metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor.prototype.onStartBuild=function(a){a._jQueryUIBindingProcessorBindings={}};metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor.prototype.processWidget=function(d,i,b,f){var e;var h=metawidget.util.splitPath(f.path);var g=metawidget.util.traversePath(f.toInspect,h.names);if(i!=="entity"&&g){e=g[b.name]}else{e=g}var a=false;if(d.hasAttribute("class")){var c=d.getAttribute("class");if(c.indexOf("ui-slider")!==-1){$(d).slider("value",e);a=true}else{if(c.indexOf("ui-spinner")!==-1){$(d.childNodes[0]).spinner("value",e);a=true}}}if(a===true||d.getMetawidget!==undefined){f._jQueryUIBindingProcessorBindings[b.name]=d}return d};metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor.prototype.save=function(f){var c=metawidget.util.splitPath(f.path);
var e=metawidget.util.traversePath(f.toInspect,c.names);for(var b in f._jQueryUIBindingProcessorBindings){var d=f._jQueryUIBindingProcessorBindings[b];if(d.getMetawidget!==undefined){this.save(d.getMetawidget());continue}d=f.getElement().ownerDocument.getElementById(d.id);var a=d.getAttribute("class");if(a.indexOf("ui-slider")!==-1){e[b]=$(d).slider("value")}else{if(a.indexOf("ui-spinner")!==-1){e[b]=$(d.childNodes[0]).spinner("value")}}}};metawidget.jqueryui.layout=metawidget.jqueryui.layout||{};metawidget.jqueryui.layout.TabLayoutDecorator=function(a){if(!(this instanceof metawidget.jqueryui.layout.TabLayoutDecorator)){throw new Error("Constructor called as a function")}metawidget.layout.createNestedSectionLayoutDecorator(a,this,"tabLayoutDecorator");var b=this.onEndBuild;this.onEndBuild=function(e){if(e.tabLayoutDecorator!==undefined){for(var c=0,d=e.tabLayoutDecorator.length;c<d;c++){$(e.tabLayoutDecorator[c]).tabs()}}if(b!==undefined){b.call(this,e)}}};metawidget.jqueryui.layout.TabLayoutDecorator.prototype.createSectionWidget=function(i,j,e,b,l){var g=i;if(g===undefined){g=metawidget.util.createElement(l,"div");g.setAttribute("id",metawidget.util.getId("property",e,l)+"-tabs");g.appendChild(metawidget.util.createElement(l,"ul"));this.getDelegate().layoutWidget(g,"property",{wide:"true"},b,l);l.tabLayoutDecorator=l.tabLayoutDecorator||[];l.tabLayoutDecorator.push(g)}else{g=i.parentNode}var f=g.childNodes[0];var c=g.getAttribute("id")+(f.childNodes.length+1);var k=metawidget.util.createElement(l,"li");var h=metawidget.util.createElement(l,"a");h.setAttribute("href","#"+c);h.hash="#"+c;k.appendChild(h);f.appendChild(k);var d=metawidget.util.createElement(l,"div");d.setAttribute("id",c);g.appendChild(d);h.innerHTML=j;return d};$.widget("metawidget.metawidget",{options:{inspector:new metawidget.inspector.PropertyTypeInspector(),widgetBuilder:new metawidget.widgetbuilder.CompositeWidgetBuilder([new metawidget.widgetbuilder.OverriddenWidgetBuilder(),new metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder(),new metawidget.widgetbuilder.ReadOnlyWidgetBuilder(),new metawidget.widgetbuilder.HtmlWidgetBuilder()]),widgetProcessors:[new metawidget.widgetprocessor.IdProcessor(),new metawidget.widgetprocessor.RequiredAttributeProcessor(),new metawidget.widgetprocessor.PlaceholderAttributeProcessor(),new metawidget.widgetprocessor.DisabledAttributeProcessor(),new metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor(),new metawidget.widgetprocessor.SimpleBindingProcessor()],layout:new metawidget.layout.HeadingTagLayoutDecorator(new metawidget.layout.TableLayout())},_create:function(){this._pipeline=new metawidget.Pipeline(this.element[0]);
this._pipeline.configure(this.options);this._overriddenNodes=[];var c=this.element[0];var d=this;c.getMetawidget=function(){return d};for(var a=0;a<c.childNodes.length;){if(c.childNodes[a].nodeType!==1){a++;continue}var b=c.childNodes[a];c.removeChild(b);this._overriddenNodes.push(b)}},_refresh:function(d){this.overriddenNodes=[];for(var a=0,c=this._overriddenNodes.length;a<c;a++){this.overriddenNodes.push(this._overriddenNodes[a].cloneNode(true))}if(d===undefined){if(arguments.length>0){throw new Error("Calling _refresh( undefined ) may cause infinite loop. Check your argument, or pass no arguments instead")}var b=metawidget.util.splitPath(this.path);d=this._pipeline.inspect(this.toInspect,b.type,b.names,this)}this._pipeline.buildWidgets(d,this)},_setOptions:function(){this._superApply(arguments);this._pipeline.configure(this.options)},setReadOnly:function(a){this.readOnly=a},inspect:function(c,a,b){return this._pipeline.inspect(c,a,b,this)},clearWidgets:function(){$(this.getElement()).empty()},buildWidgets:function(b,a){if(b!==undefined){this.toInspect=b;this.path=undefined}if(a!==undefined){this.path=a}this._refresh()},getWidgetProcessor:function(a){return this._pipeline.getWidgetProcessor(a)},getElement:function(){return this._pipeline.element},buildNestedMetawidget:function(a,c){var f=metawidget.util.createElement(this,"div");var d=$(f).metawidget(this._pipeline);d.metawidget("setReadOnly",this.readOnly||metawidget.util.isTrueOrTrueString(a.readOnly));var b=this.toInspect;var e=metawidget.util.appendPath(a,this);d.metawidget("buildWidgets",b,e);return f}})})();
