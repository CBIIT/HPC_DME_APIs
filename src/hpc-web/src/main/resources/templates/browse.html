<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="HPC Data Management" />
<meta name="author" content="SVG, Inc" />
<link rel="shortcut icon" href="img/favicon.png" />


<title>HPC Data Management Environment</title>

<link rel="stylesheet" type="text/css" href="css/ng-grid.css" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" href="css/jqtree.css" />
<!-- Bootstrap CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet" />
<!-- bootstrap theme -->
<link href="css/bootstrap-theme.css" rel="stylesheet" />
<!-- font icon -->
<link href="css/elegant-icons-style.css" rel="stylesheet" />
<link href="css/font-awesome.min.css" rel="stylesheet" />
<!-- Custom styles -->
<link rel="stylesheet" href="css/fullcalendar.css" />
<link href="css/widgets.css" rel="stylesheet" />
<link href="css/style.css" rel="stylesheet" />
<link href="css/style-responsive.css" rel="stylesheet" />
<link href="css/xcharts.min.css" rel=" stylesheet" />
<link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet" />
<!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
<!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
      <script src="js/lte-ie7.js"></script>
    <![endif]-->
<script
	src="js/angular/1.5.0/angular.js"></script>
<script
	src="js/angular/1.5.0/angular-touch.js"></script>
<script
	src="js/angular/1.5.0/angular-animate.js"></script>
<script src="js/ui-grid/csv.js"></script>
<script src="js/ui-grid/pdfmake.js"></script>
<script src="js/ui-grid/vfs_fonts.js"></script>

<script src="js/ui-grid/4.0.2/ui-grid.js"></script>
<script src="../bower_components/jquery/dist/jquery.js"></script>
<!--https://mbraak.github.io/jqTree -->
<script src="js/tree.jquery.js"></script>
<script src="js/jqTreeContextMenu.js"></script>
<link rel="stylesheet" href="css/ui-grid.css"
	type="text/css" />
<script
	src="js/bootstrap/3.3.7/bootstrap.min.js"></script>

<script th:inline="javascript">
/*<![CDATA[*/
    var start = "[";
    var end = "]";
    var data = [[${browserEntryList}]];
    var basePathName = [[${basePath}]];
    var scrollLoc = [[${scrollLoc}]];
/*]]>*/
</script>
	
<style>
/*style.css*/
.gridStyle {
	border: 1px solid rgb(212, 212, 212);
	height: 300px
}

.loader {
  border: 10px solid #f3f3f3;
  border-radius: 50%;
  border-top: 10px solid blue;
  border-right: 10px solid green;
  border-bottom: 10px solid red;
  border-left: 10px solid pink;
  width: 10px;
  height: 10px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
}

@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.myMenuStyle {
		position: absolute;
		background-color: #eee;
		border: 1px solid #000;
		list-style: none;
	}
	.myMenuStyle > li {
		background-color: #eee;
	}
</style>
</head>
<body ng-controller="MyCtrl" onload="scrollWindow()">

	<!-- container section start -->
	<section id="container" class="">
		<div th:include="header :: header"></div>
		<!--main content start-->
		<section id="main-content">
			<section class="wrapper">
				<!--Title start-->
				<div class="row">
					<div class="col-lg-12">
						<h3 class="page-header">
							<i class="fa fa-dashboard"></i> Dashboard
						</h3>
						<ol class="breadcrumb">
							<li><i class="fa fa-dashboard"></i><a
								th:href="@{/dashboard}">Dashboard</a></li>
							<li><i class="fa fa-list-alt"></i>Browse</li>
						</ol>
					</div>
				</div>
				<!--Title End-->
				<!--Row start-->
				<div class="row">
					<div class="col-lg-9 col-md-12">
						<div class="panel panel-default">
							<div class="panel-heading">
								<div class="col-md-3">
								<h2>
									<i class="fa fa-list-alt red"></i><strong>Browse</strong>
								</h2>
								</div>
								<div class="col-md-3 col-md-offset-6">
								<h2>
									<strong> <a id="refreshBrowse" class="btn btn-link btn-sm" th:href="@{/browse?refresh}"><i class="fa fa-refresh" title="Refresh" aria-hidden="true"></i></a>&nbsp;&nbsp;&nbsp;<a data-toggle="modal" id="bookmarks" class="btn btn-link btn-sm" th:href="@{/bookmarks}" data-target="#bookmarksTarget"><i class="fa fa-star" title="Bookmarks" aria-hidden="true"></i></a>&nbsp;&nbsp;&nbsp;<a data-toggle="modal" id="browsepartial" class="btn btn-link btn-sm" th:href="@{/browse?partial}" data-target="#browsePartial"><i class="fa fa-sitemap" title="Browse" aria-hidden="true"></i></a></strong>
								</h2>
								</div>
								
							</div>
							<div th:if="${error != null}">
								<div class="alert alert-error">
									<a class="close" data-dismiss="alert">Ã—</a> <label
										for="${error}" th:text="${error}"></label>
								</div>
							</div>
							<div th:if="${error == null}">
								<!--panel-body start-->
								<div class="panel-body">
									<div class="modal fade" id="bookmarksTarget" tabindex="-1" role="dialog"
										aria-labelledby="bookmarksLabel" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content"></div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>								
									<div class="modal fade" id="browsePartial" tabindex="-1" role="dialog"
										aria-labelledby="browsePartialLabel" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content"></div>
											<!-- /.modal-content -->
										</div>
										<!-- /.modal-dialog -->
									</div>								
								
									<div class="form-group">
										<div id="tree1"></div>										
									</div>
									
									<ul id="myMenu" class="dropdown-menu" role="menu" aria-labelledby="dLabel">
											<li><a href="#addCollection">Add Collection</a></li>
 											<li class="divider"></li>
											<li><a href="#addDatafile">Add Datafile</a></li>
 											<li class="divider"></li>
											<li><a href="#addBulk">Add Bulk (Globus)</a></li>
											<li><a href="#refreshNode">Refresh Node</a></li>
									</ul>	
								</div>
							</div>

						</div>
						<!--/col-->

					</div>
				</div>
				<div class="row"></div>
			</section>
		</section>
		<!--main content end-->
	</section>
	<form class="form-horizontal" id="browseForm"
	    th:action="@{/browse}"
		method="POST">
		<input type="hidden" id="selectedNodePath" name="selectedNodePath"/>
		<input type="hidden" id="selectedNodeId" name="selectedNodeId"/>
		<input type="hidden" id="scrollLoc" name="scrollLoc"/>
		<input type="hidden" id="refreshNode" name="refreshNode"/>
	</form>
	
	<!-- container section start -->

	<!-- javascripts -->
	<!-- bootstrap -->
	<script src="js/bootstrap.min.js"></script>

	<script src="js/jquery.scrollTo.min.js"></script>
	<script src="js/jquery.nicescroll.js" type="text/javascript"></script>
	<script src="assets/jquery-knob/js/jquery.knob.js"></script>
	<script src="js/jquery.sparkline.js" type="text/javascript"></script>
	<script src="js/jquery.customSelect.min.js"></script>

	<!--custome script for all page-->
	<script src="js/scripts.js"></script>

<script th:inline="javascript">
/*<![CDATA[*/
           
$(function() {
    $('#tree1').tree({
    	closedIcon: $('<i class="fa fa-folder" />'),
        openedIcon: $('<i class="fa fa-folder-open" />'),
        data: data,
        saveState: true,
        usecontextmenu: true,
        onCreateLi: function(node, $li) {
            if (node.collection) {
                $li.find('.jqtree-title').before('<span class="folder-icon"></span>');
                $li.find('.jqtree-title').after('<div id="' + ("processingIcon"+node.id) + '" style="display:inline-block; visibility:hidden" class="loader"></div>');
//                $li.find('.jqtree-element').append('<a href="#' + node.id + '" class="refresh" data-node-id="' + node.id + '">refresh</i></a>');
//                $li.find('.jqtree-element').append('<a href="#node-' + node.id + '" class="refresh" data-node-id="' + node.id + '"><i class="fa fa-refresh" title="Refresh" aria-hidden="true" data-node-id="' + node.id + '"></i></a>');
//                $li.find('.jqtree-element').append('<a id="refreshBrowse" class="btn btn-link btn-sm refresh" th:href="@{/browse?refresh}"><i class="fa fa-refresh" title="Refresh" aria-hidden="true" data-node-id="' + node.id + '"></i></a>');

            }
        }        
    });
});


$('#tree1').on('click', '.refresh', function(e) {	
	e.stopImmediatePropagation();
	var node_id = $(e.target).data('node-id');
    var node = $('#tree1').tree('getNodeById', node_id);
    refreshNode(node);
)};


function refreshNode(node) {
    
    var node_id = node.id;

    console.log('refresh: ' + node_id);
	console.log('node: ' + node);

	document.getElementById("refreshNode").value = node_id;
	document.getElementById("selectedNodePath").value = node.fullPath;
    document.getElementById("processingIcon"+node.id).style.visibility = "visible";
	document.getElementById("selectedNodeId").value = node.id;
	document.getElementById("scrollLoc").value = scrollLoc;

	$('#tree').tree('loadDataFromUrl', node_id, node);
	$("#browseForm").submit();
	$('#tree1').tree('openNode', node);
    $('#tree1').tree('selectNode', node);
    //location.href = "browse?refresh&refreshNode=" + node.fullPath;
}//);

//bind 'tree.click' event
$('#tree1').bind(
    'tree.click',
    function(event) {
        // The clicked node is 'event.node'
        var node = event.node;
        console.log("click: " + node.fullPath);
        if(node.collection)
        	location.href = "collection?action=view&path="+node.fullPath;
        else
        	location.href = "datafile?action=view&path="+node.fullPath;
    }
);

$("body").mousemove(function(e) {
    scrollLoc = e.pageY;
})

function scrollWindow()
{
	var posY = Number(scrollLoc);
	if(posY) window.scrollTo(0, posY-100);
/*	if(posY <= 500)
	{
		window.scrollBy(0, Number(scrollLoc) * 0.4);
	}
	else if(posY > 500 && posY <= 2000)
	{
		window.scrollBy(0, Number(scrollLoc) * 0.6);
	}
	else if(posY > 200 && posY <= 4000)
	{
		window.scrollBy(0, Number(scrollLoc) * 0.75);
	}
	else if(posY > 3000 && posY <= 5000)
	{
		window.scrollBy(0, Number(scrollLoc) * 0.85);
	}
	else
	{
		window.scrollBy(0, Number(scrollLoc));
	}*/
}

$('#tree1').bind('tree.open', function (e,data) {  
	document.getElementById("selectedNodePath").value = e.node.fullPath;
	var node = e.node;
    document.getElementById("processingIcon"+node.id).style.visibility = "visible";
	document.getElementById("selectedNodeId").value = node.id;
	document.getElementById("scrollLoc").value = scrollLoc;
	$("#browseForm").submit();
	$('#tree1').tree('selectNode', node);
}
);

$('#tree1').jqTreeContextMenu($('#myMenu'), {
    "addCollection": function (node) { 
    	window.location = "/addCollection?parent="+node.fullPath+"&source=browse&init";
    },
    "addDatafile": function (node) {
    	window.location = "/addDatafile?parent="+node.fullPath+"&source=browse&init";
    },
    "addBulk": function (node) {
    	window.location = "/addbulk?parent="+node.fullPath+"&source=browse&init";
    },
    "refreshNode": function (node) {
    	console.log("refresh node: " + node.id);
    	refreshNode(node);
    }


}); 

/*]]>*/
</script>

</body>
</html>
