<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="HPC Data Management" />
<meta name="author" content="SVG, Inc" />
<link rel="shortcut icon" href="img/favicon.png" />

<title>HPC Data Management Environment</title>

<!-- Bootstrap CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet" />
<!-- bootstrap theme -->
<link href="css/bootstrap-theme.css" rel="stylesheet" />
<!--external css-->
<link href="css/datepicker.css" rel="stylesheet" />
<!-- font icon -->
<link href="css/elegant-icons-style.css" rel="stylesheet" />
<link href="css/font-awesome.min.css" rel="stylesheet" />
<!-- full calendar css-->
<link href="assets/fullcalendar/fullcalendar/bootstrap-fullcalendar.css"
	rel="stylesheet" />
<link href="assets/fullcalendar/fullcalendar/fullcalendar.css"
	rel="stylesheet" />
<!-- easy pie chart-->
<link href="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.css"
	rel="stylesheet" type="text/css" media="screen" />
<!-- owl carousel -->
<link rel="stylesheet" href="css/owl.carousel.css" type="text/css" />
<link href="css/jquery-jvectormap-1.2.2.css" rel="stylesheet" />
<!-- Custom styles -->
<link rel="stylesheet" href="css/fullcalendar.css" />
<link href="css/widgets.css" rel="stylesheet" />
<link href="css/style.css" rel="stylesheet" />
<link href="css/style-responsive.css" rel="stylesheet" />
<link href="css/xcharts.min.css" rel=" stylesheet" />
<link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet" />
<!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
<!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
      <script src="js/lte-ie7.js"></script>
      <script src="https://use.fontawesome.com/d8c7e3a713.js"></script>
      
    <![endif]-->

<script th:inline="javascript">
/*<![CDATA[*/
    var searchError = [[${error}]];
    var searchCriteria  = [[${hpcSearch}]];
	var advancedCriteriaExist = [[${hpcSearch.advancedCriteria}]];
    var attributes = [[${hierarchy.getAllAttributes()}]];
    var collattributes = [[${hierarchy.getCollectionAttrsSet()}]];
    var dataattributes = [[${hierarchy.getDataobjectAttrsSet()}]];
    var collectionLevels = [[${hierarchy.getCollectionLevels()}]];
    var dataobjectLevels = [[${hierarchy.getDataobjectLevels()}]];
/*]]>*/
</script>

</head>

<body>
	<!-- container section start -->
	<section id="container" class="">
		<div th:include="header :: header"></div>
		<!--main content start-->
		<section id="main-content">
			<section class="wrapper">
				<!--Title start-->
				<div class="row">
					<div class="col-lg-12">
						<h3 class="page-header">
							<i class="fa fa-dashboard"></i> Dashboard
						</h3>
						<ol class="breadcrumb">
							<li><i class="fa fa-dashboard"></i><a
								th:href="@{/dashboard}">Dashboard</a></li>
							<li><i class="fa fa-list-alt"></i>Search</li>
						</ol>
					</div>
				</div>
				<!--Title End-->
				<!--Row start-->
				<div class="row">
					<h3>
						<UL>Search
						</UL>
					</h3>
					<br /> <br />
					<div th:if="${error != null}">
						<div class="alert alert-danger">
							<a class="close" data-dismiss="alert">Ã—</a> <label for="${error}"
								th:text="${error}"></label>
						</div>
					</div>
					<form class="form-horizontal" id="simplesearchform" action="#"
						role="form" th:action="@{/criteria}" th:object="${hpcSearch}"
						method="post" enctype="multipart/form-data">
						<div class="form-group">
							<label class="control-label col-sm-2" for="level">Search
								type:</label>
							<div class="col-sm-10">
								<label class="radio-inline"><input type="radio"
									th:field="*{searchType}" name="searchType" value="collection"
									onChange="resetRows()" />Collection</label> <label
									class="radio-inline"><input type="radio"
									th:field="*{searchType}" name="searchType" value="datafile"
									onChange="resetRows()" />Data Object</label>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="metadata">Metadata</label>
							<div class="col-sm-10 column">
								<table class="table table-bordered table-hover"
									id="metaAttrTable">
									<thead>
										<tr>
											<th class="text-center">ID</th>
											<th class="text-center">Level</th>
											<th class="text-center">Attribute Name</th>
											<th class="text-center">Operator</th>
											<th class="text-center">Attribute Value</th>
											<th class="text-center">&nbsp;</th>
										</tr>
									</thead>
									<tbody>
										<tr id='attrRow0'>
											<td style="white-space: nowrap"><label id="rowId0">A1</label>
												<input type="hidden" id="rowId0" name="rowId" value="A1" />
											</td>
											<td style="white-space: nowrap"><select size="1"
												id="level1" name="level" class="form-control"
												th:required="required"
												onChange="populateLevelAttributes(this.value, this.id)">
													<option value="ANY">ANY</option>
													<option
														th:each="entry : ${hierarchy.getCollectionLevels()}"
														th:value="${entry}" th:text="${entry}">
														Wireframe</option>
											</select></td>
											<td style="white-space: nowrap"><select size="1"
												id="attrName1" name="attrName" class="form-control"
												th:required="required">
													<option value="ANY">ANY</option>
													<option
														th:each="attrName : ${hierarchy.getCollectionAttrsSet()}"
														th:value="${attrName}" th:text="${attrName}">
														Wireframe</option>
											</select></td>
											<td style="white-space: nowrap"><select size="1"
												id="operator1" name="operator" class="form-control"
												th:required="required">
													<option value="-1">----Select----</option>
													<option th:each="entry : ${operators.entrySet()}"
														th:value="${entry.key}" th:text="${entry.value}">
														Wireframe</option>
											</select></td>
											<td style="white-space: nowrap"><input type="text"
												id='attrValue1' name="attrValue" placeholder='Value'
												class="form-control" /></td>
											<td style="white-space: nowrap"><a id="deleteAttr"
												onClick="deleteRow('attrRow0')"
												class="pull-right btn btn-default"> <i
													class="fa fa-times" aria-hidden="true"></i>
											</a></td>
										</tr>
										<tr id='attr1'></tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<a id="addAttr" class="btn btn-default pull-left"
									onClick="addRow()">Add Criteria</a>
							</div>
						</div>

						<div class="form-group" id="advanced">
							<a id="addAttr" class="btn link pull-left col-sm-2"
								onClick="advancedSearch()">Advanced Search <span
								class="menu-arrow arrow_carrot-right" id="arrow"></span>
							</a>
							<div class="col-sm-10">
								<label class="control-label col-sm-2" for="level">&nbsp;</label>
							</div>
						</div>

						<div class="form-group" id="advancedarea" style="display: none">
							<div class="col-sm-offset-2 col-sm-10">
								<textarea class="form-control" rows="5"
									th:field="*{advancedCriteria}"></textarea>
							</div>
						</div>

						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<label><input type="checkbox" th:field="*{detailed}"
									id="detailed" />&nbsp;&nbsp;Detailed results</label>
							</div>
						</div>

						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<br />
								<button type="submit" class="btn btn-md btn-primary"
									id="primaryButton" onClick="return validateAndSubmit()">Search</button>
								<button type="submit" class="btn btn-md btn-primary"
									onClick="return cancel()">Cancel</button>
							</div>
						</div>
						<input type="hidden" id="actionType" name="actionType" />
					</form>
				</div>
			</section>
		</section>
		<!--main content end-->
	</section>
	<!-- container section start -->

	<!-- javascripts -->
	<script src="js/metawidget/core/metawidget-core.min.js"
		type="text/javascript"></script>
	<script src="js/metawidget/metawidget-bootstrap.min.js"
		type="text/javascript"></script>
	<script src="js/jquery.js"></script>
	<script src="js/jquery-ui-1.10.4.min.js"></script>
	<script src="js/jquery-1.8.3.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
	<!-- bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- nice scroll -->
	<script src="js/jquery.scrollTo.min.js"></script>
	<script src="js/jquery.nicescroll.js" type="text/javascript"></script>
	<!-- charts scripts -->
	<script src="assets/jquery-knob/js/jquery.knob.js"></script>
	<script src="js/jquery.sparkline.js" type="text/javascript"></script>
	<script src="assets/jquery-easy-pie-chart/jquery.easy-pie-chart.js"></script>
	<script src="js/owl.carousel.js"></script>
	<!-- jQuery full calendar -->
	<script src="assets/fullcalendar/fullcalendar/fullcalendar.js"></script>
	<!--script for this page only-->
	<script src="js/calendar-custom.js"></script>
	<script src="js/jquery.rateit.min.js"></script>
	<!-- custom select -->
	<script src="js/jquery.customSelect.min.js"></script>
	<script src="assets/chart-master/Chart.js"></script>

	<!--custome script for all page-->
	<script src="js/scripts.js"></script>
	<!-- custom script for this page-->
	<script src="js/sparkline-chart.js"></script>
	<script src="js/easy-pie-chart.js"></script>
	<script src="js/jquery-jvectormap-1.2.2.min.js"></script>
	<script src="js/jquery-jvectormap-world-mill-en.js"></script>
	<script src="js/xcharts.min.js"></script>
	<script src="js/jquery.autosize.min.js"></script>
	<script src="js/jquery.placeholder.min.js"></script>
	<script src="js/gdp-data.js"></script>
	<script src="js/morris.min.js"></script>
	<script src="js/sparklines.js"></script>
	<script src="js/charts.js"></script>
	<script src="js/jquery.slimscroll.min.js"></script>
	<script src="js/bootstrap-datepicker.js"></script>

	<script>
  $('#createdDate').datepicker({
	    format: 'mm/dd/yyyy'
	});
      //knob
      $(function() {
        $(".knob").knob({
          'draw' : function () {
            $(this.i).val(this.cv + '%')
          }
        })
      });

      //carousel
      $(document).ready(function() {
          $("#owl-slider").owlCarousel({
              navigation : true,
              slideSpeed : 300,
              paginationSpeed : 400,
              singleItem : true

          });
      });

      //custom select box

      $(function(){
          $('select.styled').customSelect();
      });

	  /* ---------- Map ---------- */
	$(function(){
	  $('#map').vectorMap({
	    map: 'world_mill_en',
	    series: {
	      regions: [{
	        values: gdpData,
	        scale: ['#000', '#000'],
	        normalizeFunction: 'polynomial'
	      }]
	    },
		backgroundColor: '#eef3f7',
	    onLabelShow: function(e, el, code){
	      el.html(el.html()+' (GDP - '+gdpData[code]+')');
	    }
	  });
	});
  </script>

	<script type="text/javascript">
var rowId = 1;
//<![CDATA[
           
function refreshAttributes()
{
	document.getElementById("actionType").value = "refresh";
	document.getElementById("simplesearchform").submit();
}

function populateLevelAttributes(level, id)
{
	var searchTypes = document.getElementsByName('searchType');
	var type;

	for (var i = 0, length = searchTypes.length; i < length; i++) {
	    if (searchTypes[i].checked) {
	        type = searchTypes[i].value;
	        break;
	    }
	}	
	var row = id.substring(5);
	
	var attrOptions="<option value='ANY'>ANY</option>";

	if(level == "-1" || level == "ANY")
	{
		if(type == "collection")
		{
			for(var i=0;i<collattributes.length;i++)
			{
				var attr = collattributes[i];
				attrOptions = attrOptions + "<option value='"+attr+"'>"+attr+"</option>"
			}
		}
		else
		{
			for(var i=0;i<dataattributes.length;i++)
			{
				var attr = dataattributes[i];
				attrOptions = attrOptions + "<option value='"+attr+"'>"+attr+"</option>"
			}
		}
		
	}
	else
	{
		for(var i=0;i<attributes.length;i++)
		{
			var attr = attributes[i];
			var attrLevel = attr.substring(0, attr.indexOf(":"));
	
			if(attrLevel != level)
			{
				continue;
			}
	
			var attrType = attr.substring(attr.indexOf(":")+1, attr.lastIndexOf(":"));
			if(attrType != type)
			{
				continue;
			}
	
			var attrName = attr.substring(attr.lastIndexOf(":")+1);
			attrOptions = attrOptions + "<option value='"+attrName+"'>"+attrName+"</option>"
	
		}
	}

	if(level == "datafile")
	{
		for(var i=0;i<dataattributes.length;i++)
		{
			var attr = dataattributes[i];
			attrOptions = attrOptions + "<option value='"+attr+"'>"+attr+"</option>"
		}
	
	}
    $('#attrName'+(row)).empty();
    $('#attrName'+(row)).append(attrOptions);
    $('#attrName'+(row)).val($('#attrName1').val());

    var namesEle = document.getElementById('attrName'+row);
	if (namesEle != null)
		namesEle.selectedIndex = 0;

}

function resetRows()
{
    var table = document.getElementById("metaAttrTable");
    var rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;
	var searchTypes = document.getElementsByName('searchType');
	var type;

	for (var i = 0, length = searchTypes.length; i < length; i++) {
	    if (searchTypes[i].checked) {
	        type = searchTypes[i].value;
	        break;
	    }
	}	
	
    for(var i=1;i<rows;i++)
    {
    	var namesEle = document.getElementById('attrName'+i);
       	var levelsEle = document.getElementById('level1');
    	if (namesEle != null)
    	{
    		if(type == "collection")
    		{
    			var attrOptions="<option value='ANY'>ANY</option>";
    			for(var j=0;j<collattributes.length;j++)
    			{
    				var attr = collattributes[j];
    				attrOptions = attrOptions + "<option value='"+attr+"'>"+attr+"</option>"
    			}
        	    $('#attrName'+(i)).empty();
        	    $('#attrName'+(i)).append(attrOptions);

        	    var levelOptions="<option value='ANY'>ANY</option>";
    			for(var j=0;j<collectionLevels.length;j++)
    			{
    				var attr = collectionLevels[j];
    				levelOptions = levelOptions + "<option value='"+attr+"'>"+attr+"</option>"
    			}
        	    $('#level'+(i)).empty();
        	    $('#level'+(i)).append(levelOptions);
    		}
    		else
    		{
    			var attrOptions="<option value='ANY'>ANY</option>";
    			for(var k=0;k<dataattributes.length;k++)
    			{
    				var attr = dataattributes[k];
    				attrOptions = attrOptions + "<option value='"+attr+"'>"+attr+"</option>"
    			}
        	    $('#attrName'+(i)).empty();
        	    $('#attrName'+(i)).append(attrOptions);

        	    var levelOptions="<option value='ANY'>ANY</option>";
    			for(var j=0;j<dataobjectLevels.length;j++)
    			{
    				var attr = dataobjectLevels[j];
    				levelOptions = levelOptions + "<option value='"+attr+"'>"+attr+"</option>"
    			}
        	    $('#level'+(i)).empty();
        	    $('#level'+(i)).append(levelOptions);
    		}
    		namesEle.selectedIndex = 0;
    	}
    	var levelEle = document.getElementById('level'+i);
    	if (levelEle != null)
    		levelEle.selectedIndex = 0;
    	var operatorEle = document.getElementById('operator'+i);
    	if (operatorEle != null)
    		operatorEle.selectedIndex = 0;
    	var levelOperatorEle = document.getElementById('levelOperator'+i);
    	if (levelOperatorEle != null)
    		levelOperatorEle.selectedIndex = 0;
    	var valueEle = document.getElementById('attrValue'+i);
    	if (valueEle != null)
    		valueEle.value = null;
    }
}

function addRow() {
	rowId++;
    var table = document.getElementById("metaAttrTable");
    var rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;
    rows = rows - 1;
    var row = table.insertRow(rows+1);
    row.id = "attrRow"+(rows+1);
    var cell0 = row.insertCell(0);
    var cell1 = row.insertCell(1);
    var cell2 = row.insertCell(2);
    var cell3 = row.insertCell(3);
    var cell4 = row.insertCell(4);
    var cell5 = row.insertCell(5);
    cell0.innerHTML = '<label id="rowId'+ (rowId) +'">A'+ (rowId) + '</label><input type="hidden" id="rowId'+ (rowId) +'" name="rowId" value="A'+ (rowId) +'"/>';
    cell1.innerHTML = '<select id="level'+(rows+1)+'" name="level" class="form-control" th:required="required" onChange="populateLevelAttributes(this.value, this.id)"></select>';
    cell2.innerHTML = '<select id="attrName'+(rows+1)+'" name="attrName" class="form-control" th:required="required"> <option value="ANY">ANY</option></select>';
    cell3.innerHTML = '<select id="operator'+(rows+1)+'" name="operator" class="form-control" th:required="required"> <option value="-1">----Select----</option> <option value="1">=</option><option value="2">!=</option><option value="3">&lt;</option><option value="4">&gt;</option></select>';
    cell4.innerHTML = '<input type="text" id="attrValue'+(rows+1)+'" name="attrValue" placeholder="Value" class="form-control"/>';
   	cell5.innerHTML = '<a id="deleteAttr" onClick="deleteRow(\''+(row.id)+'\')" class="pull-right btn btn-default"><i class="fa fa-times" aria-hidden="true"></i></a>';

   	var levelsEle = document.getElementById('level1');
   	var $leveloptions = $("#level1 > option").clone();
    $('#level'+(rows+1)).empty();
    $('#level'+(rows+1)).append($leveloptions);
    $('#level'+(rows+1)).val($('#level1').val());

   	var namesEle = document.getElementById('attrName1');
   	var $attroptions = $("#attrName1 > option").clone();
    $('#attrName'+(rows+1)).empty();
    $('#attrName'+(rows+1)).append($attroptions);
    $('#attrName'+(rows+1)).val($('#attrName1').val());
    
   	var operatorEle = document.getElementById('operator1');
   	var $operatoroptions = $("#operator1 > option").clone();
    $('#operator'+(rows+1)).empty();
    $('#operator'+(rows+1)).append($operatoroptions);
    $('#operator'+(rows+1)).val($('#operator1').val());

	var namesEle = document.getElementById('attrName'+(rows+1));
	if (namesEle != null)
		namesEle.selectedIndex = 0;
	var levelEle = document.getElementById('level'+(rows+1));
	if (levelEle != null)
		levelEle.selectedIndex = 0;
	var operatorEle = document.getElementById('operator'+(rows+1));
	if (operatorEle != null)
		operatorEle.selectedIndex = 0;
}

function deleteRow(rowid) {
    var table = document.getElementById("metaAttrTable");
    var rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;
	if(rows <= 2)
		return;
    var row = document.getElementById(rowid);
    row.parentNode.removeChild(row);
}

function cancel() {
	window.location.replace("/dashboard");
	return false;
}

function validateAndSubmit()
{
	var inputs = new Array();
	var valid = false;
	inputs = document.getElementsByTagName("select");
	for(var i = 0; i < inputs.length; i++)
	{
		var attrName = inputs[i].getAttribute("name");
		if(attrName.startsWith("attrName"))
		{
			var suffix = attrName.substring("attrName".length);
			var attrNameValue = document.getElementsByName(attrName)[0].value;
			if(attrNameValue != "-1")
			{
				var attrOperValue = document.getElementsByName("operator"+suffix)[0].value;	
				var attrValueValue = document.getElementsByName("attrValue"+suffix)[0].value;
				if(attrOperValue == "-1" || attrValueValue == null || attrValueValue.trim().length == 0)
				{
					alert("Invalid Valid criteria. Please enter operator and value");
					return false;
				}
				valid = true;
			}
			else
			{
				var attrOperValue = document.getElementsByName("operator"+suffix)[0].value;	
				var attrValueValue = document.getElementsByName("attrValue"+suffix)[0].value;
				if(attrOperValue == "-1" || attrValueValue == null || attrValueValue.trim().length == 0)
				{
					alert("Invalid Valid criteria. Please enter operator and value");
					return false;
				}
				valid = true;
			}
		}
	}
	if(!valid)
	{
		alert("Invalid Valid criteria");
		return false;
	}
	document.getElementById("simplesearchform").submit();
}

var toggle = true;
function advancedSearch() {
	var ele = document.getElementById("advancedarea");
	var arrow = document.getElementById("arrow");
	if(toggle)
	{
		document.getElementById('arrow').setAttribute("class","menu-arrow arrow_carrot-down");
		toggle = false;
	}
	else
	{
		document.getElementById('arrow').setAttribute("class","menu-arrow arrow_carrot-right");
		toggle = true;
	}
		
	if(ele.style.display == "block") {
    		ele.style.display = "none";
  	}
	else {
		ele.style.display = "block";
	}
	window.scrollBy(0, 200);
}

if(advancedCriteriaExist) {
	// if there are advanced search criteria, restore the advancedSearch
	// box to the open state
	advancedSearch();
}

if(searchError) {
	resetRows();
	// Process the hpcSearch object and restore the level criteria
	for(var i = 0; i < searchCriteria.level.length; i++) {
		
		// The first row always exists.  Don't add it a second time.
		if(i > 0) {
			addRow();
		}
				
		// The table is one-indexed, not zero-indexed.
		var row_id = (i + 1);
		$('#level' + row_id).val(searchCriteria.level[i]).change();
		$('#attrName' + row_id).val(searchCriteria.attrName[i]);
		$('#operator' + row_id).val(searchCriteria.operator[i]);
		$('#attrValue' + row_id).val(searchCriteria.attrValue[i]);
	}	
}
//]]>
</script>
</body>
</html>
